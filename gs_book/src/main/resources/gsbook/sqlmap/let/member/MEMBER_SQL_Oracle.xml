<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
	<typeAlias alias="mvo" type="gsbook.member.service.GsMemberVO"/>
	<sql id="selectSQL">
		select 		m_num,
					m_id, 
					m_nm, 
					m_password, 
					m_adres,
					m_telno,
					m_email,
					m_sbscrbde,
					admin, 
		from 		member
	</sql>
	<resultMap class="mvo" id="memberRM">
		<result property="mNum" columnIndex="1"/>
		<result property="mId" columnIndex="2"/>
		<result property="mName" columnIndex="3"/>
		<result property="mPassword" columnIndex="4"/>
		<result property="mAddress" columnIndex="4"/>
		<result property="mTelNo" columnIndex="5"/>
		<result property="mRegDate" columnIndex="6" />
		<result property="mAdmin" columnIndex="7" nullValue="Y"/>
	</resultMap>
	
	<!-- select 쿼리 처리 태그들 -->
	<select id="selectMemberById" resultMap="memberRM">
		<include refid="selectSQL"/>
		where m_id=#mId#
	</select>
	
	
	
	<select id="loginDAO.actionLogin" resultMap="memberRM">
		<include refid="selectSQL"/>
		 WHERE m_id = #mId#
	</select>
	
	
	<insert id="Account.addAccount">                <!-- 쿼리의 식별자 : "Account.addAccount" -->
		<![CDATA[
			INSERT INTO USER_MASTER (
				  M_NUM
				, M_ID
				, M_NM
				, M_PASSWORD
				, M_ADRES
				, M_TELNO
				, M_EMAIL
				, M_SBSCRBDE
				, ADMIN
			) VALUES (
				  M_NUM.NEXTVAL
				, #id#
				, #name#
				, #pw#
				, #address#
				, #tel#
				, #email#
				, #sbsde#
				, #admin#
			)
		]]>
	</insert>
	
	
	<select id="selectAddressBydong" resultClass="member.dto.AddressTO">
			select 	zipcode, 
					sido, 
					gugun, 
					dong,
					bunji,
					seq 
		    from 	zipcode where dong like '%'||#dong#||'%'  
	</select>
	
	<select id="selectMemberByRegisterNumber" resultMap="memberRM" parameterClass="hashmap">
		<include refid="selectSQL"/>
		where 	register_number1=#reg1#
		 and	register_number2=#reg2#
	</select>
	
	<select id="selectSquence" resultClass="int">
		select member_seq.nextval 
		from dual
	</select>
	
	<insert id="insertMember" parameterClass="mto">
		insert into member values (
			#id#, #password#, #name#, #registerNumber1#, #registerNumber2#, #tel#, #memberLevel#,#mileage#,#zipcode#,#address#,#memberNum#
		)
	</insert>

	<update id="updateMember" parameterClass="mto">
		update 	member 
			set 	password=#password#, 
					name=#name#, 
					register_number1=#registerNumber1#,
					register_number2=#registerNumber2#,
					tel=#tel#,
					zipcode=#zipcode#,
					address=#address#
		where 	id=#id#
	</update>


	<!-- DML 쿼리 태그들 -->
	<delete id="deleteMemberById">
		delete from member where id=#value#
	</delete>

	
	<select id="selectMemberByRegisterNumberAndId" resultMap="memberRM" parameterClass="hashmap">
		<include refid="selectSQL"/>
		where 	id!=#id#
		 and		(register_number1=#registerNumber1#
		 and		register_number2=#registerNumber2#)
	</select>
	<select id="selectAllMember" resultMap="memberRM">
		<include refid="selectSQL"/>
	</select>
	<select id="selectMemberByMileageRange" resultMap="memberRM" parameterClass="hashmap">
		<include refid="selectSQL"/>
		where mileage between #sMileage# and #eMileage#
	</select>
	<select id="selectMemberByName" resultMap="memberRM">
		<include refid="selectSQL"/>
		where name like '%'||#value#||'%'
	</select>	
		
</sqlMap>










